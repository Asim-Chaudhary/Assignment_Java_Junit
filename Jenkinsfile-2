pipeline 
{
    agent any

    tools {
            maven 'Maven_2'
            dockerTool 'Docker_1'
            sonarQubeScanner 'sonar_1'
    }

    stages 
    {
        stage('Build') 
        {   
            agent {
                    docker {image 'maven:3.8.6-eclipse-temurin-17'}
                }
            steps 
                {
                    script{ 
                        git branch : 'main', url: 'https://github.com/Asim-Chaudhary/Assignment_Java_Junit.git'
                        //docker.image('openjdk:17-jdk').inside
                        sh 'mvn clean compile' 
                        }
                
                }

        }

        stage('Test') 
        {   
            agent {
                    docker {image 'maven:3.8.6-eclipse-temurin-11'}
                }
            steps 
                {
                    script{ 
                        git branch : 'main', url: 'https://github.com/Asim-Chaudhary/Assignment_Java_Junit.git'
                        //docker.image('openjdk:17-jdk').inside
                        sh 'mvn test' 
                        }
                
                }

        }
        stage ('Scan')
        {
            steps
                    {
                        withSonarQubeEnv(installationName: 'sonar')
                                    {
                                            sh mvn clean sonar_1 : sonar 
                                    }
                    }
        }

        stage('Deploy') 
        {
            steps 
                {
                echo 'Deploy App'
                } 

        }               
    }
    post 
    {
            always
            { emailext body: 'The Pipeline was successful.', subject: 'Pipeline Status', to: 'asim.chaudhary459@gmail.com' }
    }
}
